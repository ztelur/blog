---
title: TCP/IP详解阅读笔记（一）：TCP协议
date: 2016-06-09 12:28:33
tags:
	- TCP/IP
categories:
	- 网络
---
作者： [remcarpediem](http://ztelur.github.io/)
联系方式：[segmentfault](https://segmentfault.com/u/remcarpediem)，[csdn](http://blog.csdn.net/u012422440)，[简书](http://www.jianshu.com/users/481d9f540fb9/latest_articles)
>本文转载请注明作者、文章来源，链接，版权归作者所有。


&emsp;前段时间提交了本科毕业论文，这段时间特别空闲，于是希望研究一些基础性的技术，比如网络和编译原理。于是就找来《TCP/IP协议详解》来看，并做一些笔记，记录一下感悟或在重点。
&emsp;为了节约你的时间，本文主要内容为：
- TCP/IP协议族
- TCP和UDP的区别
- TCP提供可靠性的方式
- TCP首部格式

### **TCP/IP协议族**
&emsp;TCP/IP协议是一组网络传输协议的集合，按照网络模型的不同层次，使用不同的传输协议进行分工合作。TCP/IP的网络参考模型一共有四层，自上而下分别为应用层，传输层，网络层和数据链路层。



![TCP/IP协议分层](http://7xrxif.com1.z0.glb.clouddn.com/20160609-TCP/IP-TCPIP%E5%8D%8F%E8%AE%AE%E6%97%8F%E5%88%86%E6%9B%BE.png)

- 链路层，有时候也称为数据链路层或网络接口层，通常包括操作系统中的设备驱动程序和计算机中对应的网络接口卡。它们一起处理与电缆（或者其他任何传输媒介）的物理接口细节。
- 网络层，有时也称为互联网层，处理分组在网络中的活动，例如分组的选路。在TCP/IP协议族中，网络层协议包括IP协议，ICMP协议，以及IGMP协议。
- 传输层主要为两台主机上的应用程序提供端到端的通信，在TCP/IP协议族中，有两个互不相同的传输协议：TCP（传输控制协议）和UDP（用户数据报协议）。TCP相对安全稳定，但是UDP速度更快。
- 应用层负责处理特定的应用程序细节。几乎各种不同的TCP/IP实现都会提供下面这些通用的应用程序：
	- Telnet远程登陆
	- FTP文件传输协议
	- SMTP简单邮件传输协议
	- SNMP 简单网络管理协议 

### **TCP：传输控制协议**

&emsp;TCP和UDP都是传输层的协议，但是二者却有着很多的不同。TCP提供一种**面向连接**的，**可靠**的字节流服务。而UDP是一个简单的**面向数据报文**的传输层协议：进程中的每个输出操作都正好产生一个UDP数据报文，并且组装成一份待发送的IP数据报，而TCP协议中，应用程序产生的全体数据与真正发送的单个IP数据报可能没有什么联系。UDP也**不提供可靠性保证**。
&emsp;TCP和UDP的主要区别如图所示。

### **TCP提供可靠性的方式**
&ems;与UDP不同的是，TCP提供各种方式来保证数据传输的正确性：
- 应用数据被分割成TCP认为最合适发送的数据快。这和UDP完全不同，应用程序产生的数据报长度不变。
- TCP发送一个报文段之后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重新发送这个报文。
- 当TCP收到发自TCP连接另一端的数据，它将发送一个确认。
- TCP将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。如果收到端的检验和有差别，TCP将丢弃这个报文段。
- TCP会对收到的数据金喜重排，将收到的数据以正确的顺序交给应用层。
- TCP的接受端会放弃重复的数据
- TCP提供流量控制。TCP接受的每一方都有固定大小的缓冲空间。TCP的接受端只允许另一端发送接收端缓冲区所能容纳的数据。

### **TCP的首部**
&emsp;TCP数据被封装在一个IP数据报中，如下图所示。


![TCP和IP数据报](http://7xrxif.com1.z0.glb.clouddn.com/20160609-TCP/IP-TCPIP.png)
&emsp;下图显示TCP首部的数据结构。如果不计任何可选字段的话，它通常是20个字节。


![TCP首部格式](http://7xrxif.com1.z0.glb.clouddn.com/20160609-TCP/IP-TCPHead.png)
- 每个TCP端都包含源端和目的端的端口号，用于寻找发送端和接受端应用进程。这两个值加上IP首部的源端IP地址和目的端IP地址唯一确定一个TCP连接。
- 序号用来标识TCP发端向TCP收端发送的数据字节流，它表示在这个报文段中的第一个字节数据。如果将字节流看作在两个应用程序之间的单向流动，则TCP用序号来对每个字节进行计数。序号是32位的无符号数。
- 确认序号包含发送确认的一端所期望收到的下一个序号。因此，确认序号应当是上次已经成功收到的数据字节序号+1。只有ACK标志为1时确认序号字段才有效。
- 首部长度给出TCP首部的字节数目。需要这个值是因为任选字段的长度是可变的。
- TCP首部中有6个标志位。
  - URG：紧急指针有效标志位，当它被置为1时，紧急指针才有效。
  - ACK：确认序号有效，当它被置为1时，确认序号才有效。
  - PSH：接受方应该尽快将这个报文交给应用层。
  - RST：重建连接。
  - SYN：同步序号用来发起一个新连接。
  - FIN：发端完成发送任务。
- 窗口大小来进行TCP的流量控制。窗口大小为字节数，起始于确认序号字段指明的值，这个值是接受端期望接受的字节。
- 检验和覆盖了整个的TCP报文段：TCP首部和TCP数据。这是一个强制性的字段，一定由发端进行计算和存储，并由收端进行检验。
- 紧急指针是一个正的偏移量，和序号字段中的值相加表示紧急数据最后一个字节的序号。TCP的紧急方式是发送端向另一端发送紧急数据的一种方式。


### **后记**
&emsp;本片文章几乎就是一个读书笔记摘要。每个章节都如此，既无营养也很浪费时间，希望自己以后可以多做一些总结和实质性的文章吧。希望以后可以找到一个好的方式来写读书笔记。 
